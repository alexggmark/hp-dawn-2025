{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - show_rating: {Boolean} Show the product rating. Default: false
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - skip_styles: {Boolean} Don't include component styles. Useful when rendering multiple product cards in a loop. Default: false (optional)
  - quick_add: {Boolean} Show the quick add button.
  - transparent_background: {Boolean} Turn off background.
  - section_id: {String} The ID of the section that contains this card.
  - simple_card: {Boolean} Hide excess UI stuff for a simpler card
  - light_background: {Boolean} Turn on white background
{% endcomment %}

{%- unless skip_styles -%}
  {{ 'component-rating.css' | asset_url | stylesheet_tag }}
  {{ 'wm__component-price.css' | asset_url | stylesheet_tag }}
  {{ 'quick-order-list.css' | asset_url | stylesheet_tag }}
  {{ 'quantity-popover.css' | asset_url | stylesheet_tag }}
{%- endunless -%}

{%- if card_product and card_product != empty -%}
  {% comment %} Keeping card-wrapper for rating star component {% endcomment %}
  <div class="_group _h-full _w-full _relative card-wrapper">
    <div
      class="
        _flex
        _flex-col
        _h-full
        card--{{ settings.card_style }}
        card--media
      "
    >
      {% comment %} _h-full - deleted because breaking on mobile {% endcomment %}
      {% comment %} _aspect-square {% endcomment %}
      <div
        class="
          _relative
          _box-border
          _w-full
          _aspect-[8/9]
          {% unless transparent_background or light_background %} _bg-brand-background{% endunless %}
          {% if light_background %} _bg-brand-light{% endif %}
          "
        >
        {%- if card_product.featured_media -%}
          <div class="_absolute _inset-0 _overflow-hidden _z-0">
            <div class="
              _block
              _bg-transparent
              _overflow-hidden
              _max-w-full
              _absolute
              _inset-0
            ">
              {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
              <img
                srcset="
                  {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                  {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
                "
                src="{{ card_product.featured_media | image_url: width: 533 }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt="{{ card_product.featured_media.alt | escape }}"
                class="motion-reduce {% if card_product.media[1] != null and simple_card != true %}group-hover:_opacity-0{% endif %} _object-contain _object-center _h-full _w-full"
                {% unless lazy_load == false %}
                  loading="lazy"
                {% endunless %}
                width="{{ card_product.featured_media.width }}"
                height="{{ card_product.featured_media.height }}"
              >
              {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}

              {%- if card_product.media[1] != null and simple_card != true -%}
                <img
                  srcset="
                    {%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                    {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                    {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                    {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                    {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                    {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                    {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w
                  "
                  src="{{ card_product.media[1] | image_url: width: 533 }}"
                  sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                  alt=""
                  class="
                    motion-reduce
                    _absolute
                    _top-0
                    _opacity-0
                    group-hover:_opacity-100
                    _object-cover
                    _object-center
                    _h-full
                    _w-full
                  "
                  loading="lazy"
                  width="{{ card_product.media[1].width }}"
                  height="{{ card_product.media[1].height }}"
                >
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
        <div class="_relative _grid _p-3 _w-full _h-full" style="grid-template-rows: minmax(0, 1fr) max-content minmax(0, 1fr)">
          <div class="
            _row-start-2 _py-6 _px-4 md:_py-6 md:_px-7 _hidden
          ">
            <h3
              class="
                _mt-0
                _mb-0
              "
              {% if card_product.featured_media == null and settings.card_style == 'standard' %}
                id="title-{{ section_id }}-{{ card_product.id }}"
              {% endif %}
            >
              <a
                href="{{ card_product.url }}"
                id="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }}"
                class="full-unstyled-link"
                aria-labelledby="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }} NoMediaStandardBadge-{{ section_id }}-{{ card_product.id }}"
              >
                {{ card_product.title | escape }}
              </a>
            </h3>
          </div>
          {% comment %} Badge {% endcomment %}
          {%- unless simple_card -%}
            <div class="_row-start-1">
              {%- unless badges == false -%}
                {% render 'wm__badges', placement: 'card', product: card_product %}
              {%- endunless -%}
            </div>
          {%- endunless -%}
          {%- unless simple_card -%}
            <div class="_row-start-3 _flex _items-end _overflow-hidden">
              {% if quick_add == 'standard' %}
                <div class="
                  _z-10
                  _relative
                  _hidden
                  md:_block
                  no-js-hidden
                  _w-full
                  _opacity-0 group-hover:_opacity-100 _duration-0
                ">
                  {% render 'wm__quick-shop', card_product: card_product, product_form_id: product_form_id, section_id: section_id, full_width: true %}
                </div>
              {% endif %}
            </div>
          {%- endunless -%}
        </div>
      </div>
      <div
        class="_grid p-0 _w-full _h-full _grid-rows-[auto_min-content] _grid-cols-[minmax(0,_1fr)]"
      >
        {% comment %} Careful here, this _py also controls simple cards {% endcomment %}
        <div class="
          _row-start-1 md:_py-4 _py-2
        ">


        {% style %}
          .card-product-grid {
            display: grid;
            gap: 0.2rem;
            grid-template-areas: 
              "A"
              "C"
              "D"
              "B";
          }

          @media (min-width: 750px) {
            .card-product-grid {
              gap: 0.5rem;
              grid-template-areas:
                "A B"
                "C D";
              grid-template-columns: auto 1fr;
            }
          }
        {% endstyle %}


          <div class="
            card-product-grid
          ">
            {% comment %} ----------------------- {% endcomment %}
            {% comment %} -- (A) Product title -- {% endcomment %}
            {% comment %} ----------------------- {% endcomment %}
            <h3
              class="_text-brand-dark _overflow-hidden _whitespace-nowrap _pr-2 [grid-area:A]"
              {% if card_product.featured_media or settings.card_style == 'card' %}
                id="title-{{ section_id }}-{{ card_product.id }}"
              {% endif %}
            >
              <a
                href="{{ card_product.url }}"
                id="CardLink-{{ section_id }}-{{ card_product.id }}"
                class="
                  _no-underline
                  _block
                  _font-semibold _text-brand-dark _text-base
                  _overflow-hidden _text-ellipsis _whitespace-nowrap
                  after:_top-0
                  after:_left-0
                  after:_bottom-0
                  after:_right-0
                  after:_absolute
                  after:_z-0
                  _content-['']
                "
                aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}"
              >
                {{ card_product.title | escape }}
              </a>
            </h3>

            {% comment %} --------------- {% endcomment %}
            {% comment %} -- (B) Price -- {% endcomment %}
            {% comment %} --------------- {% endcomment %}
            <div class="[grid-area:B] md:_justify-self-end">
              {% render 'wm__price', product: card_product, price_class: '', show_compare_at_price: true %}
            </div>

            {%- unless simple_card -%}
              {% comment %} --------------------- {% endcomment %}
              {% comment %} -- (C) Description -- {% endcomment %}
              {% comment %} --------------------- {% endcomment %}
              <span class="_text-sm _text-brand-dark [grid-area:C]">
                SPF 50 Mineral Sun Stick
              </span>

              {% comment %} ---------------------- {% endcomment %}
              {% comment %} -- (D) Review stars -- {% endcomment %}
              {% comment %} ---------------------- {% endcomment %}
              <div class="_flex _items-center _gap-1 [grid-area:D] md:_justify-self-end">
                <span class="_text-sm _text-brand-primary-500">★★★★★</span>
                <span class="_font-body-condensed _font-medium _text-brand-dark _text-sm">4.5 (100)</span>
              </div>
            {%- endunless -%}
          </div>

        </div>
        {% assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id %}
        {% if quick_add == 'standard' %}
          <div class="quick-add no-js-hidden _block md:_hidden _row-start-2 _z-[1]">
            {% render 'wm__quick-shop', card_product: card_product, product_form_id: product_form_id, section_id: section_id, full_width: true %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{%- endif -%}
