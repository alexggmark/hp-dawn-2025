{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'wm__component-price.css' | asset_url | stylesheet_tag }}
{{ 'section-related-products.css' | asset_url | stylesheet_tag }}

{% comment %} From wm__card-product {% endcomment %}
{{ 'wm__component-rating.css' | asset_url | stylesheet_tag }}
{{ 'quick-order-list.css' | asset_url | stylesheet_tag }}
{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}

<div class="">
  <product-recommendations
    class="related-products isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    data-url="{{ routes.product_recommendations_url }}?limit=8"
    data-section-id="{{ section.id }}"
    data-product-id="{{ product.id }}"
  >
    {% if recommendations.performed and recommendations.products_count > 0 %}
      <h2 class="_font-heading-primary _text-brand-dark _text-xl _mb-2">
        Pairs Well With
      </h2>

      <embla-slider data-lazy>
        <div class="_overflow-hidden _relative" data-js-embla>
          <div class="_flex md:_gap-4 _gap-4 _pb-0.5 _select-none" data-js-embla-container>
            {% for recommendation in recommendations.products %}
              {% assign card_product = recommendation %}

              <div id="Slide-{{ section.id }}-{{ forloop.index }}"
                class="
                _w-[150px]
                md:_w-[130px]
                _flex-none
                _flex
                _justify-center
                _items-center
                _snap-start
                _h-auto
              ">
                {% comment %} {% render 'wm__card-product',
                  card_product: recommendation,
                  skip_styles: skip_card_product_styles,
                  simple_card: true
                %} {% endcomment %}
                {% comment %} quick_add: "standard", {% endcomment %}

                {% comment %} TODO: START OF CARD PRODUCT {% endcomment %}

                  <div class="_group _h-full _w-full _relative card-wrapper">
                    <div
                      class="
                        _flex
                        _flex-col
                        _h-full
                        card--{{ settings.card_style }}
                        card--media
                      "
                    >
                      {% comment %} _aspect-square {% endcomment %}
                      <div
                        class="
                          _relative
                          _box-border
                          _w-full
                          _aspect-[8/9]
                          _bg-brand-background
                          "
                        >
                        {%- if card_product.featured_media -%}
                          <div class="_absolute _inset-0 _overflow-hidden _z-0">
                            <div class="
                              _block
                              _bg-transparent
                              _overflow-hidden
                              _max-w-full
                              _absolute
                              _inset-0
                            ">
                              {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
                              <img
                                srcset="
                                  {%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                                  {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                                  {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                                  {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                                  {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                                  {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                                  {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w
                                "
                                src="{{ card_product.featured_media | image_url: width: 533 }}"
                                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                                alt="{{ card_product.featured_media.alt | escape }}"
                                class="motion-reduce {% if card_product.media[1] != null %}group-hover:_opacity-0{% endif %} _object-contain _object-center _h-full _w-full"
                                {% unless lazy_load == false %}
                                  loading="lazy"
                                {% endunless %}
                                width="{{ card_product.featured_media.width }}"
                                height="{{ card_product.featured_media.height }}"
                              >
                              {% comment %}theme-check-enable ImgLazyLoading{% endcomment %}

                              {%- if card_product.media[1] != null -%}
                                <img
                                  srcset="
                                    {%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                                    {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                                    {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                                    {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                                    {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                                    {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                                    {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w
                                  "
                                  src="{{ card_product.media[1] | image_url: width: 533 }}"
                                  sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                                  alt=""
                                  class="
                                    motion-reduce
                                    _absolute
                                    _top-0
                                    _opacity-0
                                    group-hover:_opacity-100
                                    _object-cover
                                    _object-center
                                    _h-full
                                    _w-full
                                  "
                                  loading="lazy"
                                  width="{{ card_product.media[1].width }}"
                                  height="{{ card_product.media[1].height }}"
                                >
                              {%- endif -%}
                            </div>
                          </div>
                        {%- endif -%}
                        <div class="_relative _grid _p-3 _w-full _h-full" style="grid-template-rows: minmax(0, 1fr) max-content minmax(0, 1fr)">
                          <div class="
                            _py-6 _px-4 md:_py-6 md:_px-7 _hidden
                          ">
                            <h3
                              class="
                                _mt-0
                                _mb-0
                              "
                              {% if card_product.featured_media == null and settings.card_style == 'standard' %}
                                id="title-{{ section_id }}-{{ card_product.id }}"
                              {% endif %}
                            >
                              <a
                                href="{{ card_product.url }}"
                                id="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }}"
                                class="full-unstyled-link"
                                aria-labelledby="StandardCardNoMediaLink-{{ section_id }}-{{ card_product.id }} NoMediaStandardBadge-{{ section_id }}-{{ card_product.id }}"
                              >
                                {{ card_product.title | escape }}
                              </a>
                            </h3>
                          </div>
                        </div>
                      </div>
                      <div
                        class="p-0 _w-full"
                      >
                        {% comment %} Careful here, this _py also controls simple cards {% endcomment %}
                        <div class="
                          _pt-2
                        ">
                          <div class="
                            
                          ">
                            {% comment %} ----------------------- {% endcomment %}
                            {% comment %} -- (A) Product title -- {% endcomment %}
                            {% comment %} ----------------------- {% endcomment %}
                            <h3
                              class="_text-brand-dark _overflow-hidden _whitespace-nowrap"
                              {% if card_product.featured_media or settings.card_style == 'card' %}
                                id="title-{{ section_id }}-{{ card_product.id }}"
                              {% endif %}
                            >
                              <a
                                href="{{ card_product.url }}"
                                id="CardLink-{{ section_id }}-{{ card_product.id }}"
                                class="
                                  _no-underline
                                  _block
                                  _font-semibold _text-brand-dark _text-sm
                                  _overflow-hidden _text-ellipsis _whitespace-nowrap
                                  after:_top-0
                                  after:_left-0
                                  after:_bottom-0
                                  after:_right-0
                                  after:_absolute
                                  after:_z-0
                                  _content-['']
                                "
                                aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}"
                              >
                                {{ card_product.title | escape }}
                              </a>
                            </h3>

                            {% comment %} --------------- {% endcomment %}
                            {% comment %} -- (B) Price -- {% endcomment %}
                            {% comment %} --------------- {% endcomment %}
                            {% comment %} Temporary class just to fix sizing {% endcomment %}
                            {% style %}
                              .related-products-price-controls .price {
                                font-size: 0.8rem!important;
                              }
                              .related-products-price-controls .price ._text-base {
                                font-size: 0.8rem!important;
                              }
                            {% endstyle %}
                            <div class="related-products-price-controls">
                              {% render 'wm__price', product: card_product, price_class: '', show_compare_at_price: true %}
                            </div>
                          </div>
                        </div>
                        {% comment %} {% assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id %} {% endcomment %}

                        <div class="">
                          {% comment %} <button class="_button-primary _w-full _py-2.5 _text-xs"> {% endcomment %}
                            {% comment %} <span>Add to Cart</span> {% endcomment %}
                             
                            {% comment %} TODO: START PRODUCT FORM {% endcomment %}

                            {%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: forloop.index -%}

                            {% comment %} Removing this because it screwed up Monster cart override {% endcomment %}
                            {% comment %} <product-form
                              class="product-form"
                              data-hide-errors="false"
                              data-section-id="{{ section.id }}"
                            > {% endcomment %}
                              <div class="product-form__error-message-wrapper" role="alert" hidden>
                                <span class="svg-wrapper">
                                  {{- 'icon-error.svg' | inline_asset_content -}}
                                </span>
                                <span class="product-form__error-message"></span>
                              </div>

                              {%- form 'product',
                                card_product,
                                id: product_form_id,
                                class: 'form',
                                novalidate: 'novalidate',
                                data-type: 'add-to-cart-form'
                              -%}
                                <input
                                  type="hidden"
                                  name="id"
                                  value="{{ card_product.selected_or_first_available_variant.id }}"
                                  {% if card_product.selected_or_first_available_variant.available == false
                                    or quantity_rule_soldout
                                    or card_product.selected_or_first_available_variant == null
                                  %}
                                    disabled
                                  {% endif %}
                                  class="product-variant-id"
                                >

                                <div class="product-form__buttons">
                                  {%- liquid
                                    assign check_against_inventory = true
                                    if card_product.selected_or_first_available_variant.inventory_management != 'shopify' or card_product.selected_or_first_available_variant.inventory_policy == 'continue'
                                      assign check_against_inventory = false
                                    endif
                                    if card_product.selected_or_first_available_variant.quantity_rule.min > card_product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
                                      assign quantity_rule_soldout = true
                                    endif
                                  -%}
                                  <button
                                    id="ProductSubmitButton-{{ section_id }}-{{ forloop.index }}"
                                    type="submit"
                                    name="add"
                                    class="_button-primary _px-1 _py-2.5 _text-xs _w-full"
                                    {% if card_product.selected_or_first_available_variant.available == false
                                      or quantity_rule_soldout
                                      or card_product.selected_or_first_available_variant == null
                                    %}
                                      disabled
                                    {% endif %}
                                  >
                                    <span>
                                      {%- if card_product.selected_or_first_available_variant == null -%}
                                        {{ 'products.product.unavailable' | t }}
                                      {%- elsif card_product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                                        {{ 'products.product.sold_out' | t }}
                                      {%- else -%}
                                        {% comment %} {{ 'products.product.add_to_cart_with_price' | t: price: product.price }} {% endcomment %}
                                        Add to cart
                                      {%- endif -%}
                                    </span>
                                    {%- render 'loading-spinner' -%}
                                  </button>
                                </div>
                              {%- endform -%}
                            {% comment %} </product-form> {% endcomment %}

                            {% comment %} TODO: END PRODUCT FORM {% endcomment %}
                          {% comment %} </button> {% endcomment %}
                        </div>
                      </div>
                    </div>
                  </div>





                {% comment %} TODO: END OF CARD PRODUCT {% endcomment %}
              </div>
            {% endfor %}
          </div>
        </div>
      </embla-slider>
    {% endif %}
  </product-recommendations>
</div>
