{% # theme-check-disable %}
<script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>
<script src="https://unpkg.com/embla-carousel-progress-bar/embla-carousel-progress-bar.umd.js"></script>
{% # theme-check-enable %}

{% # theme-check-disable %}
<script src="https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js"></script>
{% # theme-check-enable %}

{% comment %} Global listener for cart crossing threshold, only activates if cookies set in wm__gwp-picker.liquid active {% endcomment %}
{% comment %} <script src="{{ 'wm__gwp-picker-listener.js' | asset_url }}" defer="defer"></script> {% endcomment %}

{% comment %} A/B testing in PostHog feature flag controls {% endcomment %}
<script src="{{ 'wm__ab-test.js' | asset_url }}" defer="defer"></script>

{%- if request.page_type == 'product' -%}
  <script>
    function addToRecentlyViewed(productHandle) {
      const maxProducts = 12;
      let recentlyViewed = JSON.parse(localStorage.getItem('shopifyProductRecentlyViewed') || '[]');
      
      recentlyViewed = recentlyViewed.filter(handle => handle !== productHandle);
      
      recentlyViewed.unshift(productHandle);
      
      if (recentlyViewed.length > maxProducts) {
        recentlyViewed = recentlyViewed.slice(0, maxProducts);
      }
      
      localStorage.setItem('shopifyProductRecentlyViewed', JSON.stringify(recentlyViewed));
    }

    addToRecentlyViewed('{{ product.handle }}');
  </script>
{%- endif -%}